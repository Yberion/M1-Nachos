<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nachos: AddrSpace Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nachos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('class_addr_space.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="class_addr_space-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">AddrSpace Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Defines the data structures to keep track of memory resources of executing user programs (address spaces).  
 <a href="class_addr_space.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="addrspace_8hpp_source.html">addrspace.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for AddrSpace:</div>
<div class="dyncontent">
<div class="center"><img src="class_addr_space__coll__graph.png" border="0" usemap="#_addr_space_coll__map" alt="Collaboration graph"/></div>
<map name="_addr_space_coll__map" id="_addr_space_coll__map">
<area shape="rect" title="Defines the data structures to keep track of memory resources of executing user programs (address spa..." alt="" coords="20,95,107,121"/>
<area shape="rect" href="class_translation_table.html" title="Defines the data structures used for address translation." alt="" coords="5,5,121,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acd3d2a68587b04ed5740e87895613821"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_addr_space.html#acd3d2a68587b04ed5740e87895613821">AddrSpace</a> (<a class="el" href="class_open_file.html">OpenFile</a> *exec_file, <a class="el" href="class_process.html">Process</a> *p, int *err)</td></tr>
<tr class="separator:acd3d2a68587b04ed5740e87895613821"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add4a9431912394188b08c03346632737"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_addr_space.html#add4a9431912394188b08c03346632737">~AddrSpace</a> ()</td></tr>
<tr class="separator:add4a9431912394188b08c03346632737"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad9c7caf4271badbf81367093e75f61e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_addr_space.html#aad9c7caf4271badbf81367093e75f61e">StackAllocate</a> ()</td></tr>
<tr class="separator:aad9c7caf4271badbf81367093e75f61e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa63198854284a9da3f41b1757b314aa1"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_addr_space.html#aa63198854284a9da3f41b1757b314aa1">getCodeStartAddress</a> ()</td></tr>
<tr class="separator:aa63198854284a9da3f41b1757b314aa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5e079c82bbefc86285cf9aab75648e5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_addr_space.html#ad5e079c82bbefc86285cf9aab75648e5">Mmap</a> (<a class="el" href="class_open_file.html">OpenFile</a> *f, int size)</td></tr>
<tr class="separator:ad5e079c82bbefc86285cf9aab75648e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60a781e4938ad8ec1854842708a3a438"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_open_file.html">OpenFile</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_addr_space.html#a60a781e4938ad8ec1854842708a3a438">findMappedFile</a> (int32_t addr)</td></tr>
<tr class="separator:a60a781e4938ad8ec1854842708a3a438"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a0bd5650b339c21069abf1be627bbba61"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_translation_table.html">TranslationTable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_addr_space.html#a0bd5650b339c21069abf1be627bbba61">translationTable</a></td></tr>
<tr class="separator:a0bd5650b339c21069abf1be627bbba61"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines the data structures to keep track of memory resources of executing user programs (address spaces). </p>
<p>The constructor of this class takes as parameter an ELF executable file and loads it in the RAM of the (simulated) MIPS processor. This part will be modified in the virtual memory assignment to implement demand paging (on-demand loading of code/data). </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="acd3d2a68587b04ed5740e87895613821"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd3d2a68587b04ed5740e87895613821">&#9670;&nbsp;</a></span>AddrSpace()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AddrSpace::AddrSpace </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_open_file.html">OpenFile</a> *&#160;</td>
          <td class="paramname"><em>exec_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_process.html">Process</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an address space to run a user program. Load the program from a file "exec_file", and set everything up so that we can start executing user instructions.</p>
<p>Executables are in ELF (Executable and Linkable Format) (see <a class="el" href="elf32_8hpp.html" title="Data structures pertaining to the ELF32 1.1 file format specification.">elf32.hpp</a>) and can be generated using a standard MIPS cross-compiler (here gcc).</p>
<p>For now, the code and data are entirely loaded into memory and the stacks are preallocated (NB: memory here stands for the memory of the simulated MIPS machine). Code/Data loading will be changed in the virtual memory assignment.</p>
<p>Don't look at this code right now. You may get lost. You will have plenty of time to do so in the virtual memory assignment</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exec_file</td><td>is the file containing the object code to load into memory, or NULL when the address space should be empty </td></tr>
    <tr><td class="paramname">process</td><td>process to be executed </td></tr>
    <tr><td class="paramname">err</td><td>error code 0 if OK, -1 otherwise </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_addr_space_acd3d2a68587b04ed5740e87895613821_cgraph.png" border="0" usemap="#class_addr_space_acd3d2a68587b04ed5740e87895613821_cgraph" alt=""/></div>
<map name="class_addr_space_acd3d2a68587b04ed5740e87895613821_cgraph" id="class_addr_space_acd3d2a68587b04ed5740e87895613821_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,164,57"/>
<area shape="rect" href="class_open_file.html#a0af8cd52ec71a2ad407039cebee2ef3d" title=" " alt="" coords="212,31,337,57"/>
<area shape="rect" href="utility_8cpp.html#af1c6878736cbd9e1b531898d8951d613" title=" " alt="" coords="427,5,495,32"/>
<area shape="rect" href="class_file_header.html#a676d88bbc37d3d108625be75d637a8e6" title="in bytes" alt="" coords="385,56,537,83"/>
<area shape="rect" href="utility_8cpp.html#a79c7d1acabdb48f6f6a80ec0abf7cf89" title=" " alt="" coords="585,5,701,32"/>
</map>
</div>

</div>
</div>
<a id="add4a9431912394188b08c03346632737"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add4a9431912394188b08c03346632737">&#9670;&nbsp;</a></span>~AddrSpace()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AddrSpace::~AddrSpace </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Deallocates an address space and in particular frees all memory it uses (RAM and swap area). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_addr_space_add4a9431912394188b08c03346632737_cgraph.png" border="0" usemap="#class_addr_space_add4a9431912394188b08c03346632737_cgraph" alt=""/></div>
<map name="class_addr_space_add4a9431912394188b08c03346632737_cgraph" id="class_addr_space_add4a9431912394188b08c03346632737_cgraph">
<area shape="rect" title=" " alt="" coords="5,144,172,171"/>
<area shape="rect" href="class_translation_table.html#a2fcfe9b5d9c81991b664970d3a052ed5" title=" " alt="" coords="236,5,431,32"/>
<area shape="rect" href="class_translation_table.html#a2f89216744cb7e446d7f17d517e8fefa" title=" " alt="" coords="238,56,429,83"/>
<area shape="rect" href="class_translation_table.html#a1314ab5a89657842d5fcb56b3ed8730f" title=" " alt="" coords="254,107,413,149"/>
<area shape="rect" href="class_translation_table.html#a4f29cbac75ad518a17d8f70e873dffef" title=" " alt="" coords="222,173,445,200"/>
<area shape="rect" href="class_swap_manager.html#a8b6cfc56bc9db70e379f9ec3826df6d7" title=" " alt="" coords="223,224,444,251"/>
<area shape="rect" href="class_physical_mem_manager.html#a7eee399c2c1a0866cd575dc6c6b96687" title="Frees the page and deletes the existing page mapping." alt="" coords="220,275,447,317"/>
<area shape="rect" href="class_bit_map.html#aee4445b4d2079c96f5c87896717569d2" title=" " alt="" coords="495,177,596,204"/>
<area shape="rect" href="utility_8cpp.html#af1c6878736cbd9e1b531898d8951d613" title=" " alt="" coords="511,228,579,255"/>
<area shape="rect" href="utility_8cpp.html#a79c7d1acabdb48f6f6a80ec0abf7cf89" title=" " alt="" coords="644,228,760,255"/>
<area shape="rect" href="class_list.html#a8cf5a283a4782ac19fcf00e6ac6a594f" title=" " alt="" coords="496,283,595,309"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a60a781e4938ad8ec1854842708a3a438"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60a781e4938ad8ec1854842708a3a438">&#9670;&nbsp;</a></span>findMappedFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_open_file.html">OpenFile</a> * AddrSpace::findMappedFile </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Search if the address is in a memory-mapped file</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>virtual address to be searched for </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>address of file descriptor if found, NULL otherwise </dd></dl>

</div>
</div>
<a id="aa63198854284a9da3f41b1757b314aa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa63198854284a9da3f41b1757b314aa1">&#9670;&nbsp;</a></span>getCodeStartAddress()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32_t AddrSpace::getCodeStartAddress </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the address of the first instruction to execute in the process found in the ELF file </p>

</div>
</div>
<a id="ad5e079c82bbefc86285cf9aab75648e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5e079c82bbefc86285cf9aab75648e5">&#9670;&nbsp;</a></span>Mmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int AddrSpace::Mmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_open_file.html">OpenFile</a> *&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Map an open file in memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>pointer to open file descriptor </td></tr>
    <tr><td class="paramname">size</td><td>size to be mapped (rounded up to next page boundary)</td></tr>
  </table>
  </dd>
</dl>
<p>Map an open file in memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>pointer to open file descriptor </td></tr>
    <tr><td class="paramname">size</td><td>size to be mapped in bytes (rounded up to next page boundary) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the virtual address at which the file is mapped </dd></dl>

</div>
</div>
<a id="aad9c7caf4271badbf81367093e75f61e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad9c7caf4271badbf81367093e75f61e">&#9670;&nbsp;</a></span>StackAllocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int AddrSpace::StackAllocate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocates a new stack of size cfg-&gt;UserStackSize</p>
<p>Allocation is done by calling Alloc, a very simple allocation procedure of virtual memory areas.</p>
<dl class="section return"><dt>Returns</dt><dd>stack pointer (at the end of the allocated stack)</dd></dl>
<p>Allocates a new stack of size g_cfg-&gt;UserStackSize </p><pre class="fragment">Allocation is done by calling Alloc, a very simple
allocation procedure of virtual memory areas.

\return stack pointer (at the end of the allocated stack)
</pre> 
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a0bd5650b339c21069abf1be627bbba61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bd5650b339c21069abf1be627bbba61">&#9670;&nbsp;</a></span>translationTable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_translation_table.html">TranslationTable</a>* AddrSpace::translationTable</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Translation table. This table will be discovered in the virtual memory assignement, and is used to know where virtual pages are allocated in RAM. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>kernel/<a class="el" href="addrspace_8hpp_source.html">addrspace.hpp</a></li>
<li>kernel/<a class="el" href="addrspace_8cpp.html">addrspace.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_addr_space.html">AddrSpace</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
